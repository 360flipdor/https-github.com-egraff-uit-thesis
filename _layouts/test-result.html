---
layout: default
---
{% comment %} Convert number to string {% endcomment %}
{% capture build_number %}{{ page.travis.build-number }}{% endcapture %}

{% comment %} Get test result from JSON {% endcomment %}
{% assign result_map = site.data.travis-builds[build_number] %}

{% comment %} See if test passed or failed {% endcomment %}
{% if page.travis.test-result == 0 %}
{% assign passed = true %}
{% else %}
{% assign passed = false %}
{% endif %}

{% capture title %}Test results for Travis build #{{ page.travis.build-number }}{% endcapture %}
<div class="page">
  <h1 class="page-title">Test results for
    <a href="https://magnum.travis-ci.com/egraff/uit-thesis/builds/{{ page.travis.build-id }}">Travis build #{{ page.travis.build-number }}</a>
  </h1>
  <p>
  {% if passed %}
    PASSED!
  {% else %}
    FAILED!
  {% endif %}
  </p>

  {% unless result_map %}
    No results from regression tests!
  {% else %}
    <p>Num tests: {{ result_map.num_tests }}, in build {{ build_number }}!</p>
    
    {% assign failed_tests = result_map.failed_tests %}
    {% for failed_test_map in failed_tests %}
      <h2>{{ failed_test_map.test_name }}</h2>
      {% if failed_test_map.build_succeeded %}
        {% assign failed_pages = failed_test_map.failed_pages %}
        <p>Pages with diff:</p>
        {% for pagenum in failed_pages %}
          {{ pagenum }}: <img src="diffs/diff_{{ failed_test_map.test_name }}_{{ pagenum }}.png" />
        {% endfor %}
      {% else %}
        {% assign stdout_lines = failed_test_map.proc.stdout %}
        {% assign stderr_lines = failed_test_map.proc.stderr %}
        {% capture log_file %}{{ failed_test_map.log_file | replace_first:'.build','build' }}{% endcapture %}
        <p>Build failed!</p>
        stdout output:
        <pre>{% for stdout_line in stdout_lines %}{{ stdout_line }}
{% endfor %}</pre>
        stderr output:
        <pre>{% for stderr_line in stderr_lines %}{{ stderr_line }}
{% endfor %}</pre>
        {% if log_file %}
          LaTeX log file: <a href="{{ log_file }}">{{ log_file }}</a>
        {% endif %}
      {% endif %}
    {% endfor %}
  {% endunless %}

</div>
